<?xml version="1.0"?>


<bindings id="snowlTreeBindings"
          xmlns="http://www.mozilla.org/xbl"
          xmlns:xbl="http://www.mozilla.org/xbl"
          xmlns:html="http://www.w3.org/1999/xhtml"
          xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">
  
  <binding id="tree" extends="chrome://browser/content/places/tree.xml#places-tree">
    <implementation>

      <!-- Selection on right click, may be different than currentIndex -->
      <field name="_currentSelectedIndex">-1</field>
      <property name="currentSelectedIndex"
                onget="return this._currentSelectedIndex;"
                onset="return this._currentSelectedIndex = val;"/>

      <method name="restoreSelection">
        <parameter name="items"/>
        <body><![CDATA[
          let strArray = [], intArray = [], itemIds = [];
          if (items)
            itemIds = items;
          else {
            strArray = this.getAttribute("itemids").split(",");
            for each (let intg in strArray)
              intArray.push(parseInt(intg));
            itemIds = intArray;
          }
          this.selectItems(itemIds);
          if (itemIds == -1)
            return;
          this.boxObject.ensureRowIsVisible(this.currentIndex)
          ]]></body>
      </method>

    </implementation>

    <handlers>
      <!-- Restore tree selection on drag end -->
      <handler event="dragend"><![CDATA[
        SnowlUtils.gMouseEvent = false;
        this.restoreSelection();
      ]]></handler>
    </handlers>
  </binding>

</bindings>
